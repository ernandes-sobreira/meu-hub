<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meu Mundo — Ernandes Sobreira</title>
  <meta name="theme-color" content="#ffffff"/>

  <style>
    :root{
      --bg:#ffffff;
      --txt:#0b1020;
      --muted:#5d667a;
      --line:#e9ecf4;
      --shadow: 0 18px 50px rgba(15,23,42,.10);
      --radius: 18px;

      /* Vibrantes */
      --red:#ff2d55;
      --green:#00d084;
      --blue:#00c2ff;
      --purple:#7c3aed;
      --yellow:#ffd000;
      --orange:#ff6a00;
      --pink:#ff3bd4;
      --teal:#00f0c8;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--txt);
      background:
        radial-gradient(900px 280px at 10% 0%, rgba(0,194,255,.18), transparent 60%),
        radial-gradient(900px 280px at 90% 0%, rgba(255,45,85,.14), transparent 55%),
        radial-gradient(1200px 420px at 50% 110%, rgba(124,58,237,.12), transparent 60%),
        #fff;
    }

    .wrap{max-width:1150px; margin:0 auto; padding:22px 16px 70px;}

    header{display:flex; gap:16px; flex-wrap:wrap; align-items:stretch;}

    .hero{
      flex:1 1 680px;
      border:1px solid var(--line);
      background:#fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-160px -160px auto auto;
      width:360px; height:360px;
      background:
        conic-gradient(from 180deg,
          rgba(255,45,85,.40),
          rgba(0,208,132,.38),
          rgba(0,194,255,.35),
          rgba(255,208,0,.38),
          rgba(124,58,237,.35),
          rgba(255,106,0,.35),
          rgba(255,45,85,.40)
        );
      border-radius:999px;
      filter: blur(24px);
      opacity:.95;
    }

    .row{display:flex; gap:14px; align-items:center; flex-wrap:wrap; position:relative; z-index:1;}

    .avatar{
      width:86px; height:86px; border-radius:22px;
      border:1px solid var(--line);
      background: linear-gradient(135deg, rgba(0,194,255,.20), rgba(255,45,85,.14));
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .avatar img{width:100%; height:100%; object-fit:cover; display:block;}
    .ph{font-weight:950; letter-spacing:.5px; font-size:22px; opacity:.85}

    h1{margin:0; font-size:22px;}
    .bio{margin:6px 0 0; color:var(--muted); line-height:1.55; font-size:13.5px;}

    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
    .chip{
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
      padding:8px 10px;
      font-weight:900;
      font-size:12.5px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .dot{width:10px; height:10px; border-radius:999px;}

    .panel{
      flex:0 0 360px;
      border:1px solid var(--line);
      background:#fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .panel h2{margin:0 0 10px; font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:.3px;}

    .hint{margin-top:10px; color:var(--muted); font-size:12.5px; line-height:1.5;}
    .counts{margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;}
    .pill{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      font-weight:900;
      font-size:12.5px;
      color:var(--muted);
    }

    /* Seções */
    .section{
      margin-top:18px;
      border:1px solid var(--line);
      background:#fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .sectionHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .sectionHead h3{margin:0; font-size:16px;}
    .sectionHead p{margin:0; color:var(--muted); font-size:13px; line-height:1.45;}

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 640px){ .grid{grid-template-columns: 1fr;} }

    /* Cards */
    .card{
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 12px 28px rgba(15,23,42,.08);
      background:#fff;
      overflow:hidden;
      min-height: 150px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .bar{height:10px;}
    .body{padding:12px;}
    .kicker{font-weight:950; font-size:12px; letter-spacing:.3px; text-transform:uppercase; opacity:.75; margin-bottom:6px;}
    .title{font-weight:950; font-size:15px; margin:0; line-height:1.2;}
    .desc{margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.45; min-height: 42px;}

    .actions{display:flex; gap:10px; padding:12px; padding-top:0;}
    .go{
      flex:1;
      border:0;
      border-radius: 14px;
      padding:11px 12px;
      font-weight:950;
      cursor:pointer;
      color:#fff;
      box-shadow: 0 14px 24px rgba(0,0,0,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .copy{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:11px 12px;
      background:#fff;
      font-weight:950;
      cursor:pointer;
      user-select:none;
    }

    /* Gradientes */
    .g-red    { background: linear-gradient(90deg, var(--red),   var(--orange)); }
    .g-green  { background: linear-gradient(90deg, var(--green), var(--teal)); }
    .g-blue   { background: linear-gradient(90deg, var(--blue),  var(--purple)); }
    .g-purple { background: linear-gradient(90deg, var(--purple),var(--pink)); }
    .g-yellow { background: linear-gradient(90deg, var(--yellow),var(--orange)); }
    .g-mix    { background: linear-gradient(90deg, var(--pink),  var(--blue)); }

    .toast{
      position:fixed;
      right:14px;
      bottom:14px;
      background:#111827;
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      display:none;
      box-shadow: 0 18px 40px rgba(0,0,0,.22);
      font-weight:900;
      z-index:999;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <section class="hero">
        <div class="row">
          <div class="avatar" id="avatar">
            <span class="ph" id="ph">ES</span>
          </div>

          <div>
            <h1 id="name">Ernandes Sobreira</h1>
            <div class="bio" id="bio">
              Cacerense • Biólogo • Pai do Davi e da Sara • Marido da Bárbara<br/>
              Mestre em Ecologia e Conservação da Biodiversidade • Doutor em Ciência (Radboud University)<br/>
              Professor visitante da Universidade do Estado de Mato Grosso (UNEMAT)
            </div>

            <div class="chips" id="chips"></div>

            <div class="hint" style="margin-top:12px;">
              Hub fixo (público). Para adicionar/remover apps, edite <code>data/links.json</code> no GitHub.
            </div>
          </div>
        </div>
      </section>

      <aside class="panel">
        <h2>Status</h2>
        <div class="counts" id="counts"></div>
        <div class="hint" id="status">Carregando seus apps…</div>
      </aside>
    </header>

    <div id="sections"></div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const $ = (id)=>document.getElementById(id);

    const GRADS = ["g-red","g-green","g-blue","g-purple","g-yellow","g-mix"];

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.style.display = "none", 1600);
    }

    function initials(name){
      const parts = String(name||"").trim().split(/\s+/).filter(Boolean);
      const a = parts[0]?.[0] || "E";
      const b = parts[1]?.[0] || (parts[0]?.[1] || "S");
      return (a+b).toUpperCase();
    }

    function normUrl(u){
      return String(u||"").trim()
        .replace(/\s+/g,"")
        .replace(/#.*$/,"")
        .replace(/\/+$/,"/");
    }

    function uniqueLinks(list){
      const seen = new Set();
      const out = [];
      for(const l of (list||[])){
        const key = normUrl(l.url).toLowerCase();
        if(!key) continue;
        if(seen.has(key)) continue;
        seen.add(key);
        out.push({ ...l, url: normUrl(l.url) });
      }
      return out;
    }

    function groupByCategory(data){
      const map = new Map();
      (data.categories||[]).forEach(c=> map.set(c.id, { cat:c, links:[] }));
      (data.links||[]).forEach(l=>{
        if(map.has(l.catId)) map.get(l.catId).links.push(l);
      });
      for(const [k,v] of map){
        v.links.sort((a,b)=> (a.title||"").localeCompare((b.title||""), "pt-BR"));
      }
      return [...map.values()];
    }

    function renderCounts(data){
      const counts = $("counts");
      counts.innerHTML = "";
      const total = (data.links||[]).length;

      const pill = (txt)=> {
        const s = document.createElement("span");
        s.className = "pill";
        s.textContent = txt;
        return s;
      }

      counts.appendChild(pill(`${total} apps`));
      (data.categories||[]).forEach(c=>{
        const n = (data.links||[]).filter(x=>x.catId===c.id).length;
        counts.appendChild(pill(`${c.name}: ${n}`));
      });
    }

    function renderSections(data){
      const sections = $("sections");
      sections.innerHTML = "";

      const groups = groupByCategory(data);
      let shown = 0;

      groups.forEach((g, gi)=>{
        if(!g.links || g.links.length===0) return;

        const sec = document.createElement("section");
        sec.className = "section";

        const head = document.createElement("div");
        head.className = "sectionHead";

        const left = document.createElement("div");
        const h3 = document.createElement("h3");
        h3.textContent = g.cat?.name || "Categoria";
        const p = document.createElement("p");
        p.textContent = g.cat?.desc || "";
        left.appendChild(h3);
        if(p.textContent) left.appendChild(p);

        head.appendChild(left);

        const grid = document.createElement("div");
        grid.className = "grid";

        g.links.forEach((l, idx)=>{
          shown++;
          const card = document.createElement("div");
          card.className = "card";

          const grad = GRADS[(gi + idx) % GRADS.length];

          const bar = document.createElement("div");
          bar.className = "bar " + grad;

          const body = document.createElement("div");
          body.className = "body";

          const kicker = document.createElement("div");
          kicker.className = "kicker";
          kicker.textContent = g.cat?.name || "Categoria";

          const title = document.createElement("div");
          title.className = "title";
          title.textContent = l.title || "(Sem título)";

          const desc = document.createElement("div");
          desc.className = "desc";
          desc.textContent = l.desc || "Sem descrição.";

          body.appendChild(kicker);
          body.appendChild(title);
          body.appendChild(desc);

          const actions = document.createElement("div");
          actions.className = "actions";

          const go = document.createElement("button");
          go.className = "go " + grad;
          go.innerHTML = `Abrir <span style="opacity:.9">↗</span>`;
          go.onclick = ()=> window.open(l.url, "_blank", "noopener,noreferrer");

          const copy = document.createElement("button");
          copy.className = "copy";
          copy.textContent = "Copiar";
          copy.onclick = async ()=>{
            try{
              await navigator.clipboard.writeText(l.url);
              toast("Link copiado!");
            }catch{
              toast("Não consegui copiar.");
            }
          };

          actions.appendChild(go);
          actions.appendChild(copy);

          card.appendChild(bar);
          card.appendChild(body);
          card.appendChild(actions);

          grid.appendChild(card);
        });

        sec.appendChild(head);
        sec.appendChild(grid);
        sections.appendChild(sec);
      });

      $("status").textContent = `Mostrando tudo (${shown} cards).`;
    }

    async function init(){
      const res = await fetch("data/links.json", { cache: "no-store" });
      if(!res.ok) throw new Error("links.json não encontrado");
      const data = await res.json();

      data.links = uniqueLinks(data.links||[]);

      $("name").textContent = data.profile?.name || "Meu Mundo";
      $("bio").innerHTML = (data.profile?.bio || "").replaceAll("\n","<br/>");
      $("ph").textContent = initials(data.profile?.name || "Ernandes Sobreira");

      // Foto fixa opcional
      const imgPath = data.profile?.photo || "assets/profile.jpg";
      const av = $("avatar");
      const img = new Image();
      img.onload = ()=>{
        av.innerHTML = "";
        img.style.width="100%";
        img.style.height="100%";
        img.style.objectFit="cover";
        av.appendChild(img);
      };
      img.src = imgPath;

      // Chips
      const chips = $("chips");
      chips.innerHTML = "";
      const colors = ["var(--red)","var(--green)","var(--blue)","var(--purple)","var(--yellow)","var(--orange)","var(--pink)","var(--teal)"];
      (data.profile?.chips || []).forEach((c, i)=>{
        const s = document.createElement("span");
        s.className = "chip";
        const d = document.createElement("span");
        d.className = "dot";
        d.style.background = colors[i % colors.length];
        const t = document.createElement("span");
        t.textContent = c;
        s.appendChild(d);
        s.appendChild(t);
        chips.appendChild(s);
      });

      renderCounts(data);
      renderSections(data);
    }

    init().catch(err=>{
      console.error(err);
      $("status").textContent = "Erro: crie o arquivo data/links.json no repositório (e confirme GitHub Pages).";
    });
  </script>
</body>
</html>
